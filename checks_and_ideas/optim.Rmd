---
title: "Comparing Optim to Bisection Implementation"
author: "Robin Tu"
date: "8/26/2020"
output: html_document
---

```{r setup, include=TRUE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
library("RSpectra")
library("tidyverse")
library("uca")
library("microbenchmark")

mouse = read_csv("../contrastive/experiments/datasets/Data_Cortex_Nuclear.csv")
mouse[is.na(mouse)] = 0

## remove duplicate rows and columns
mouse = distinct(mouse) %>% select(-which(duplicated(t(mouse))))

tg = filter(mouse, Behavior == "S/C", Treatment %in% c("Saline")) %>%
  select(-c(MouseID, class, Treatment, Behavior))
bg = filter(mouse, Behavior == "C/S", Treatment %in% c("Saline")) %>%
  select(-c(MouseID, class, Treatment, Behavior))

classes = as.factor(tg$Genotype)
X = scale(select(tg, -Genotype))
B = scale(filter(bg, Genotype == "Control") %>% select(-Genotype))
B2 = scale(filter(bg, Genotype == "Ts65Dn") %>% select(-Genotype))

covX = cov(X)
covB = cov(B)
covB2 = cov(B2)
```


 making sure implementation of UCA matches previous results
```{R}
bi_single <- uca(A = covX, B = covB, method = "cov", algo = "bisection")
optim_single <- uca(A = covX, method = "cov", B = covB, algo = "optim")
bi_single$values; optim_single$values;
all.equal(bi_single, optim_single)
```
 speed test
 
```{R}
microbenchmark(bi_single = uca(A = covX, B = covB, method = "cov", algo = "bisection"),
optim_single = uca(A = covX, B = covB, method = "cov", algo = "optim"))
```

make sure this works for more than 1 data set.

```{R}
bi_double <- uca(A = covX, B = list(covB, covB2), method = "cov", algo = "bisection")
optim_double <- uca(A = covX, B = list(covB, covB2), method = "cov", algo = "optim")

bi_double$tau
optim_double$tau
```

speed test for multiple data sets

```{R}
microbenchmark(bi_double = uca(A = covX, B = list(covB, covB2), method = "cov", algo = "bisection"),
optim_double = uca(A = covX, B = list(covB, covB2), method = "cov", algo = "optim"))
```

testing out data method for single background. results match

```{R}
opt_single_data = uca(X, B, nv = 2, method = "data", algo = "optim")
bi_single_data =  uca(X, B, nv = 2, method = "data", algo = "bisection")
opt_single_data$tau; bi_single_data$tau
```

testing method for data method, multiple backgrounds. results match.

```{R}
opt_double_data = uca(A = X, B = list(B,B2), nv = 2, method = "data", algo = "optim")
bi_double_data =  uca( X,list(B,B2), nv = 2, method = "data", algo = "bisection")
opt_double_data$tau; bi_double_data$tau
```

speed test for single and multi-background setting for data method

```{R}
microbenchmark(single_bisection = uca(X, B, nv = 2, method = "data", algo = "bisection"),
               single_optim = uca(X, B, nv = 2, method = "data", algo = "optim"))
microbenchmark(multiple_bisection = uca(A = X, B = list(B,B2), nv = 2, method = "data", algo = "bisection"),
               multiple_optim = uca(A = X, B = list(B,B2), nv = 2, method = "data", algo = "optim"))

```
